@page "/"
@page "/index.html"

@using Blazor.Fluxor
@using Store.Climb
@using Gumby.Model.Climb
@inject IState<ClimbState> ClimbState
@inject IDispatcher Dispatcher

<style>
    .app-fab--fixed {
        position: fixed;
        bottom: 1rem;
        right: 1rem;
    }
</style>

<MatList SingleSelection="true" TwoLine="true">
    @if (ClimbState.Value.Climbs.Count == 0)
    {
        <MatListItem>
            <MatListItemText>
                <MatListItemPrimaryText>
                    Welcome to Gumby Climb!
                </MatListItemPrimaryText>
                <MatBlazor.MatListItemSecondaryText>
                    Click the blue + button below to add your first climb.
                </MatBlazor.MatListItemSecondaryText>
            </MatListItemText>
        </MatListItem>
    }
    else
    {
        @foreach (var climb in ClimbState.Value.Climbs)
        {
            <MatListItem>
                <MatListItemText>
                    <MatListItemPrimaryText>
                        @(@climb.OccurredAt.UtcDateTime.ToLocalTime().ToString("g"))
                    </MatListItemPrimaryText>
                    <MatBlazor.MatListItemSecondaryText>
                        @climb.RouteName
                    </MatBlazor.MatListItemSecondaryText>
                </MatListItemText>
            </MatListItem>
        }
    }
</MatList>

<MatFAB class="app-fab--fixed" OnClick="@OpenAddClimbModal" Icon="@MatIconNames.Add"></MatFAB>

<MatDialog IsOpen="@_isOpenAddClimbModal">
    <MatDialogTitle>Add Climb</MatDialogTitle>
    <MatDialogContent>
        <MatIcon Icon="camera"></MatIcon>
    </MatDialogContent>
    <MatDialogActions>
        <MatButton OnClick="@CancelAddClimbClicked">Cancel</MatButton>
        <MatButton OnClick="@OkAddClimbClicked">OK</MatButton>
    </MatDialogActions>
</MatDialog>

@functions{
    private bool _isOpenAddClimbModal = false;

    void OpenAddClimbModal()
    {
        _isOpenAddClimbModal = true;
    }

    void OkAddClimbClicked()
    {
        Dispatcher.Dispatch(new AddClimbAction(new ClimbMinimal()));
        _isOpenAddClimbModal = false;
    }

    void CancelAddClimbClicked()
    {
        _isOpenAddClimbModal = false;
    }
}